--- a/assets/game/shaders/final.fsh
+++ b/assets/game/shaders/final.fsh
@@ -1,4 +1,4 @@
-#version 330 core
+ï»¿#version 330 core
 
 uniform sampler2D primaryScene;
 uniform sampler2D glowParts;  // The second color buffer (outGlow var)
@@ -6,12 +6,16 @@
 uniform sampler2D godrayParts;
 uniform sampler2D ssaoScene;
 
+#if VSMOD_SSR > 0
+uniform sampler2D ssrScene;
+#endif
+
 uniform float gammaLevel;
 uniform float brightnessLevel;
 uniform float sepiaLevel;
 uniform float damageVignetting;
 uniform float frostVignetting;
-uniform float extraGamma = 1.0;
+uniform float extraGamma = 1;
 uniform float windWaveCounter;
 uniform float glitchEffectStrength;
 
@@ -35,7 +39,7 @@
 
 vec4 ColorGrade(vec4 color) {
 	// I don't know why, but this seems to make the scene look a lot better
-	color.a = dot(color.rgb, vec3(0.299, 0.587, 0.114)); 
+	color.a = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 	
 	vec3 hsl = rgb2hsl(color.rgb);
 
@@ -47,7 +51,7 @@
 	
 	
 	color.rgb = hsl2rgb(hsl);
-
+	
 	color.rgb = pow(color.rgb, vec3(1.0 / extraGamma));
 
 	color.rgb *= brightnessLevel;
@@ -84,6 +88,7 @@
 
 	
 	
+	
 	// Limit brightness
 	//float b = (color.r + color.b + color.g) / 3;
 	//color.rgb /= max(1, b);
@@ -104,6 +109,11 @@
 		vec4 color = texture(primaryScene, texCoord);
 	#endif	
     
+#if VSMOD_SSR > 0
+	vec4 ssr = texture(ssrScene, texCoord);
+	color.rgb = mix(color.rgb, ssr.rgb, ssr.a);
+#endif
+
 	color.a=1;
 	float bloomSub = 0;
 	#if BLOOM == 1
@@ -123,24 +133,28 @@
 	#if SSAOLEVEL > 0
 		color.rgb *= min(1, texture(ssaoScene, texCoord).r + bloomSub);
 		//if (texCoord.x < 0.5) {
-		//color.rgb = texture(ssaoScene, texCoord).rgb;
+		//	color.rgb = texture(ssaoScene, texCoord).rgb;
 		//}
 	#endif
 	
-	
 	#if GODRAYS > 0
-		vec4 grc = texture(godrayParts, texCoord) * 1;
-		color.rgb += grc.rgb;
-		color.rgb = min(color.rgb, vec3(1));
-		color.a=1;
+		vec4 grc = texture(godrayParts, texCoord);
+		float maxComp = max(max(grc.r, grc.g), grc.b);
+		if (maxComp > 0.005) {
+			float scaleMul = 1.0 / maxComp;
+			grc *= scaleMul;
+			//color.rgb += grc.rgb * maxComp;
+			color.rgb = mix(color.rgb, grc.rgb*1.5, maxComp);
+			//color.rgb = grc.rgb * maxComp;
+			color.rgb = min(color.rgb, vec3(1));
+			color.a=1;
+		}
 	#endif
-	
+
 	vec4 gradedColor = ColorGrade(color);
-	
 	outColor = mix(color, gradedColor, gradedColor.a);
-	
-
 
+	
 	// Vignetting
 	vec2 position = (gl_FragCoord.xy * invFrameSize.xy) - vec2(0.5);
 	float grayvignette = 1 - smoothstep(1.1, 0.75 - 0.45, length(position));
@@ -184,4 +198,6 @@
 	outColor.rgb = mix(outColor.rgb, vec3(0), grayvignette);
 	
 	outColor.a=1;
+	
+	//outColor.rg=texCoord.xy;
 }
\ No newline at end of file
